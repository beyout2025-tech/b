<style>
    .tab-btn { background: rgba(255,255,255,0.2); border: 1px solid white; color: white; padding: 8px 15px; border-radius: 20px; font-size: 0.8rem; }
    .tab-btn.active { background: var(--accent); border-color: var(--accent); }
    .report-row { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; font-size: 0.9rem; }
</style>

<div class="dashboard-home">
    <div class="tab-container" style="display: flex; gap: 10px; justify-content: center; margin-bottom: 20px;">
        <button class="tab-btn active" onclick="switchTab('daily-rep', this)">اليومية</button>
        <button class="tab-btn" onclick="switchTab('exam-rep', this)">الاختبارات</button>
        <button class="tab-btn" onclick="switchTab('stats-rep', this)">الإحصائيات</button>
    </div>

    <div id="daily-rep" class="tab-content">
        <div class="stat-card">
            <h6>سجل المتابعة اليومي</h6>
            <div id="daily-data">جاري التحميل...</div>
        </div>
    </div>

    <div id="exam-rep" class="tab-content" style="display:none;">
        <div class="stat-card">
            <h6>نتائج الاختبارات والشهادات</h6>
            <div id="exam-data">لا يوجد نتائج مرصودة بعد.</div>
        </div>
    </div>

    <div id="stats-rep" class="tab-content" style="display:none;">
        <div class="stat-card">
            <h6>مستوى الأداء العام</h6>
            <div style="margin: 20px 0;">
                <div class="progress" style="height: 20px; border-radius: 10px;">
                    <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated bg-success" style="width: 0%"></div>
                </div>
                <small id="progress-text" style="color: #666;"></small>
            </div>
            <div class="row g-2">
                <div class="col-6"><div class="p-2 border rounded">حضور: <b id="attendance-rate">-</b></div></div>
                <div class="col-6"><div class="p-2 border rounded">تقييم: <b id="overall-grade">-</b></div></div>
            </div>
        </div>
    </div>
</div>

<script>
    (async function initReports() {
        const student = JSON.parse(localStorage.getItem('student_session'));
        if (!student) return;

        // 1. جلب ملخص الأداء (الدالة التي برمجناها في الـ Apps Script)
        // ملاحظة: هنا سنستخدم fetch بدلاً من google.script.run لأننا في بيئة استضافة خارجية
        try {
            const resp = await fetch(`${WEB_APP_URL_Main}?action=getProfile&studentId=${student.studentId}`);
            const profile = await resp.json();
            
            if(profile.result === "success") {
                document.getElementById('attendance-rate').innerText = "90%"; // قيمة تجريبية
                document.getElementById('overall-grade').innerText = profile.data.level;
                document.getElementById('progress-bar').style.width = "75%";
                document.getElementById('progress-text').innerText = "تم إنجاز 75% من المستوى الحالي";
            }
            
            document.getElementById('daily-data').innerHTML = `
                <div class="report-row"><span>الحفظ:</span> <b>سورة البقرة (1-10)</b></div>
                <div class="report-row"><span>الأخطاء:</span> <b class="text-danger">2</b></div>
                <div class="report-row"><span>الأداء:</span> <b class="text-success">ممتاز ⭐</b></div>
            `;
        } catch(e) { console.error(e); }
    })();
</script>

